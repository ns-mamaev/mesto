(()=>{"use strict";var e={form:".form",formInput:".form__item",closeButton:".popup__close-button",submitButton:".form__button",popupProfile:".popup_content_edit-profile",profileEditButton:".profile__edit-button",profileAvatar:".profile__avatar",profileName:".profile__name",profileAbout:".profile__about",popupAddCard:".popup_content_add-card",addCardButton:".profile__add-button",cardsList:".elements__list",cardTemplate:"#photo-card-template",card:".photo-card",cardTitle:".photo-card__title",cardImage:".photo-card__image",cardLikeButton:".photo-card__like-button",cardLikeActiveClass:"photo-card__like-button_liked",cardLikesCounter:".photo-card__likes-counter",cardDeleteButton:".photo-card__delete-button",popupImage:".popup_content_zoomed-card-image",zoomedImg:".popup__zoomed-image",zoomedImgCaption:".popup__zoomed-image-caption",openedPopupClass:"popup_opened",confirmationPopup:".popup_content_confirmation",popupAvatar:".popup_content_edit-avatar",avatarEditButton:".profile__avatar-wrapper"};function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var n=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formElement=t,this._inputSelector=n.inputSelector,this._errorSelector=n.errorSelector,this._submitButtonSelector=n.submitButtonSelector,this._buttonDisabledClass=n.submitButtonDisabledClass,this._inputErrorClass=n.inputErrorClass,this._errorClass=n.errorClass}var n,r;return n=e,(r=[{key:"_hasInvalidInputs",value:function(){return this._fieldsList.map((function(e){return e.inputElement})).some((function(e){return!e.validity.valid}))}},{key:"_toggleButtonState",value:function(){this._hasInvalidInputs()?(this._buttonElement.setAttribute("disabled",""),this._buttonElement.classList.add(this._buttonDisabledClass)):(this._buttonElement.removeAttribute("disabled"),this._buttonElement.classList.remove(this._buttonDisabledClass))}},{key:"_showInputError",value:function(e,t){e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(e,t){e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}},{key:"_checkInputValidity",value:function(e,t){e.validity.valid?this._hideInputError(e,t):this._showInputError(e,t)}},{key:"_setEventListeners",value:function(){var e=this;this._fieldsList=[],this._formElement.querySelectorAll(this._inputSelector).forEach((function(t){var n=t.parentNode.querySelector(e._errorSelector),r={inputElement:t,errorElement:n};e._fieldsList.push(r),t.addEventListener("input",(function(){e._checkInputValidity(t,n),e._toggleButtonState()}))})),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this._toggleButtonState()}},{key:"enableValidation",value:function(){this._setEventListeners()}},{key:"resetValidation",value:function(){var e=this;this._toggleButtonState(),this._fieldsList.forEach((function(t){e._hideInputError(t.inputElement,t.errorElement)}))}}])&&t(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),e}();function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n){var r=n.config,o=n.clickOnImgHandler,i=n.clickOnRemoveButtonHandler,a=n.setLike,u=n.removeLike,c=n.currentUserId;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cardData=t,this._isOwnCard=t.owner._id===c,this._currentUserId=c,this._config=r,this._handleClickOnImg=o,this._handleClickOnRemoveButton=i,this._setLike=a,this._removeLike=u}var t,n;return t=e,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._config.cardTemplate).content.querySelector(this._config.card).cloneNode(!0)}},{key:"getElement",value:function(){return this._element}},{key:"getId",value:function(){return this._cardData._id}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._elementTitle=this._element.querySelector(this._config.cardTitle),this._elementImg=this._element.querySelector(this._config.cardImage),this._elementlikeButton=this._element.querySelector(this._config.cardLikeButton),this._elementLikesCounter=this._element.querySelector(this._config.cardLikesCounter),this._elementRemoveButton=this._element.querySelector(this._config.cardDeleteButton),this._isOwnCard||(this._elementRemoveButton.remove(),this._elementRemoveButton=null),this._setEventListeners(),this._elementTitle.textContent=this._cardData.name,this._elementImg.src=this._cardData.link,this._elementImg.alt=this._cardData.name,this._updateLikes(),this._element}},{key:"_setEventListeners",value:function(){var e=this;this._elementImg.addEventListener("click",(function(){e._handleClickOnImg(e._cardData.name,e._cardData.link)})),this._elementlikeButton.addEventListener("click",(function(){e._handleClickOnLike()})),this._isOwnCard&&this._elementRemoveButton.addEventListener("click",(function(){e._handleClickOnRemoveButton(e)}))}},{key:"_updateLikes",value:function(){this._elementLikesCounter.textContent=this._cardData.likes.length,this._checkLikeStatus()?this._elementlikeButton.classList.add(this._config.cardLikeActiveClass):this._elementlikeButton.classList.remove(this._config.cardLikeActiveClass)}},{key:"_checkLikeStatus",value:function(){var e=this;return this._cardData.likes.map((function(e){return e._id})).some((function(t){return t===e._currentUserId}))}},{key:"_handleClickOnLike",value:function(){var e=this;(this._checkLikeStatus()?this._removeLike:this._setLike)(this._cardData._id).then((function(t){e._cardData=t,e._updateLikes()}))}},{key:"removeCard",value:function(){this._element.remove(),this._element=null}}])&&r(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popupElement=document.querySelector(t),this._closeButton=this._popupElement.querySelector(n.closeButton),this._openedClass=n.openedPopupClass,this._handleEscClose=this._handleEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popupElement.classList.add(this._openedClass),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popupElement.classList.remove(this._openedClass),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"setEventListeners",value:function(){var e=this;this._popupElement.addEventListener("mousedown",(function(t){return e._handleCliskClose(t)}))}},{key:"_handleCliskClose",value:function(e){e.target!==this._popupElement&&e.target!==this._closeButton||this.close()}}])&&i(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(){return s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=l(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},s.apply(this,arguments)}function l(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function p(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(r);if(o){var n=h(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return p(this,e)});function a(e,t){var n,r=t.config;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e,r))._image=n._popupElement.querySelector(r.zoomedImg),n._caption=n._popupElement.querySelector(r.zoomedImgCaption),n}return t=a,(n=[{key:"open",value:function(e,t){this._image.alt=e,this._image.src=t,this._caption.textContent=e,s(h(a.prototype),"open",this).call(this)}}])&&c(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(a);function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(){return y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=v(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},y.apply(this,arguments)}function v(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}function g(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(r);if(o){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function a(e,t){var n,r=t.config,o=t.submitHandler;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e,r))._handleSubmit=o,n._form=n._popupElement.querySelector(r.form),n._submitButton=n._form.querySelector(r.submitButton),n._inputList=n._form.querySelectorAll(r.formInput),n}return t=a,(n=[{key:"_getInputValues",value:function(){var e={};return this._inputList.forEach((function(t){return e[t.name]=t.value})),e}},{key:"setInputValues",value:function(e){this._inputList.forEach((function(t){t.value=e[t.name]}))}},{key:"_submit",value:function(e){var t=this;e.preventDefault(),this._submitButton.textContent="Сохранение...",this._submitButton.setAttribute("disabled",""),this._handleSubmit(this._getInputValues()).then((function(){t._submitButton.textContent="Cохранено!",t.close(),setTimeout((function(){t._submitButton.textContent="Сохранить",t._submitButton.removeAttribute("disabled"),t._form.reset()}),500)}))}},{key:"setEventListeners",value:function(){var e=this;y(k(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){e._submit(t)}))}}])&&m(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(a);function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(){return O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=L(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},O.apply(this,arguments)}function L(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}function S(e,t){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},S(e,t)}function B(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=I(r);if(o){var n=I(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return B(this,e)});function a(e,t){var n,r=t.config,o=t.submitHandler;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e,r))._form=n._popupElement.querySelector(r.form),n._handleSubmit=o,n._submitButton=n._form.querySelector(r.submitButton),n}return t=a,(n=[{key:"setData",value:function(e){this._data=e}},{key:"setEventListeners",value:function(){var e=this;O(I(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){t.preventDefault(),e._submitButton.textContent="Выполнение...",e._submitButton.setAttribute("disabled",""),e._handleSubmit(e._data).then((function(){e._submitButton.textContent="Выполнено!",e.close(),setTimeout((function(){e._submitButton.textContent="Да",e._submitButton.removeAttribute("disabled")}),1e3)}))}))}}])&&C(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(a);function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var R=function(){function e(t,n){var r=n.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=r,this._container=document.querySelector(t)}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){return t._renderer(e)}))}},{key:"addItem",value:function(e){this._container.prepend(e)}}])&&j(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var T=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._nameField=document.querySelector(t.profileName),this._aboutField=document.querySelector(t.profileAbout),this._avatarElement=document.querySelector(t.profileAvatar),this._user=n}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return this._user}},{key:"getUserId",value:function(){return this._user._id}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about;this._user.name=t,this._user.about=n,this._nameField.textContent=t,this._aboutField.textContent=n}},{key:"setAvatar",value:function(e){var t=e.avatar;this._avatarElement.src=t}}])&&D(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var A,U=new(function(){function e(t){var n=t.baseUrl,r=t.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=n,this._headers=r}var t,n;return t=e,(n=[{key:"_handleResponse",value:function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}},{key:"_getData",value:function(e){var t=this;return fetch("".concat(this._baseUrl).concat(e),{headers:{authorization:this._headers.authorization}}).then((function(e){return t._handleResponse(e)}))}},{key:"getUserInfo",value:function(){return this._getData("/users/me")}},{key:"getInitialCards",value:function(){return this._getData("/cards")}},{key:"_changeData",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl).concat(t),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then((function(e){return n._handleResponse(e)}))}},{key:"changeUserInfo",value:function(e){return this._changeData(e,"/users/me")}},{key:"changeAvatar",value:function(e){return this._changeData(e,"/users/me/avatar")}},{key:"addCard",value:function(e){var t=this;return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then((function(e){return t._handleResponse(e)}))}},{key:"_handleLike",value:function(e,t){var n=this;return fetch("".concat(this._baseUrl,"/cards/").concat(t,"/likes"),{method:e,headers:{authorization:this._headers.authorization}}).then((function(e){return n._handleResponse(e)}))}},{key:"setLike",value:function(e){return this._handleLike("PUT",e)}},{key:"removeLike",value:function(e){return this._handleLike("DELETE",e)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:{authorization:this._headers.authorization}})}}])&&q(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-47",headers:{authorization:"c057a3e7-5ee0-421c-b032-822b62f6abd9","Content-Type":"application/json"}}),x={};A={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button",submitButtonDisabledClass:"form__button_disabled",inputErrorClass:"form__item_type_error",errorSelector:".form__error",errorClass:"form__error_visible"},document.querySelectorAll(A.formSelector).forEach((function(e){var t=new n(e,A),r=e.getAttribute("name");x[r]=t,t.enableValidation()}));var z=new E(e.popupProfile,{config:e,submitHandler:function(e){return U.changeUserInfo(e).then((function(e){var t=e.name,n=e.about;W.setUserInfo({name:t,about:n})})).catch((function(e){return console.log("Невозможно обновить профиль: ".concat(e))}))}});z.setEventListeners(),document.querySelector(e.profileEditButton).addEventListener("click",(function(){x["edit-profile"].resetValidation(),z.setInputValues(W.getUserInfo()),z.open()}));var V=new E(e.popupAvatar,{config:e,submitHandler:function(e){return U.changeAvatar(e).then((function(e){W.setAvatar(e)})).catch((function(e){return console.log("Невозможно обновить аватар: ".concat(e))}))}});V.setEventListeners(),document.querySelector(e.avatarEditButton).addEventListener("click",(function(){x["edit-avatar"].resetValidation(),V.open()}));var H=new P(e.confirmationPopup,{config:e,submitHandler:function(e){return U.deleteCard(e.getId()).then((function(){e.removeCard()}))}});H.setEventListeners();var N=new d(e.popupImage,{config:e});N.setEventListeners(),document.querySelector(e.addCardButton).addEventListener("click",(function(){x["add-card"].resetValidation(),Q.open()}));var F=function(e,t){N.open(e,t)},J=function(e){H.open(),H.setData(e)},M=function(e){return U.setLike(e)},G=function(e){return U.removeLike(e)},K=function(t){return X.addItem(function(t){return new o(t,{config:e,clickOnImgHandler:F,clickOnRemoveButtonHandler:J,setLike:M,removeLike:G,currentUserId:W.getUserId()}).generateCard()}(t))},Q=new E(e.popupAddCard,{config:e,submitHandler:function(e){return U.addCard(e).then((function(e){K(e)})).catch((function(e){return console.log("Ошибка добавления карточки: ".concat(e))}))}});Q.setEventListeners();var W,X=new R(e.cardsList,{renderer:K});U.getUserInfo().then((function(t){return(W=new T(e,t)).setUserInfo(t),W.setAvatar(t),document.querySelector(".page").classList.remove("page_loading"),U.getInitialCards()})).then((function(e){X.renderItems(e)})).catch((function(e){return console.log("Ошибка запроса к серверу: ".concat(e))}))})();